---
   layout: default
　　title: 前端跨域
---
## 跨域

在多个项目组共存的公司，基本上都会遇到跨域的问题，之前在小公司，项目相对独立，基本上没有接触过跨域的问题，现在的日常工作中常常会涉及到跨域的问题，但是仍然不甚了解，因而自认为应该专门学习下。

### 1、跨域问题产生的原因
跨域问题是因为浏览器的同源策略导致的，可以认为是浏览器的一种安全限制。

### 2、浏览器的同源策略

| URL           | 说明           | 是否允许通信  |
| ------------- |:-------------:| -----|
| http://www.a.com/a.js<br/>http://www.a.com/b.js | 同一域名下 | 允许 |
| http://www.a.com/lab/a.js<br/>http://www.a.com/script/b.js | 同一域名下不同文件夹 | 允许 |
| http://www.a.com:8000/a.js<br/>http://www.a.com/b.js | 同一域名，不同端口 | 不允许 |
| http://www.a.com/a.js<br/>https://www.a.com/b.js  |  同一域名，不同协议 | 不允许 |
| http://www.a.com/a.js<br/>http://70.32.92.74/b.js | 域名和域名对应ip | 不允许 |
| http://www.a.com/a.js<br/>http://script.a.com/b.js | 主域相同，子域不同 | 不允许 |
| http://www.a.com/a.js<br/>http://a.com/b.js | 同一域名，不同二级域名（同上）| 不允许 |
| http://www.cnblogs.com/a.js<br/>http://www.a.com/b.js | 不同域名 | 不允许 |

**这里有两点注意：**

1. 如果是协议和端口造成的跨域问题，前端是无能为力的
2. 在跨域问题上，域仅仅是通过“URL的首部”来识别而不会去尝试判断相同的ip地址对应着两个域或两个域是否在同一个ip上。

*“URL的首部”指window.location.protocol + window.location.host，也可以理解为“Domains, protocols and ports must match”。*

### 3、跨域方式

**1、jsonp**

JSONP包含两部分：回调函数和数据。回调函数是当响应到来时要放在当前页面被调用的函数。数据就是传入回调函数中的json数据，也就是回调函数的参数了。

原理是** \<script>标签的src属性是没有跨域的限制的 **

<pre><code class="JavaScript">
    function handleResponse(response){
        console.log('The responsed data is: '+response.data);
    }
    var script = document.createElement('script');
    script.src = 'http://www.baidu.com/json/?callback=handleResponse';
    document.body.insertBefore(script, document.body.firstChild);

    /*handleResonse({"data": "zhe"})*/
    //原理如下：
    //当我们通过script标签请求时
    //后台就会根据相应的参数(json,handleResponse)
    //来生成相应的json数据(handleResponse({"data": "zhe"}))
    //最后这个返回的json数据(代码)就会被放在当前js文件中被执行
    //至此跨域通信完成
</code></pre>

此外，比较常用的方式是将 jQuery.ajax 的 dataType 设置为 'jsonp' 实现。

*如果设为dataType: 'jsonp'，这个$.ajax方法就和ajax XmlHttpRequest没什么关系了，取而代之的则是JSONP协议。JSONP是一个非官方的协议，它允许在服务器端集成Script tags返回至客户端，通过javascript callback的形式实现跨域访问。*




___